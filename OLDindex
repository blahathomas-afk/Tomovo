<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tomova hlasovací aplikace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3f51b5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(26, 35, 126, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* Hvězdy pro noční oblohu */
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, #fff, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent),
                radial-gradient(1px 1px at 200px 60px, #fff, transparent),
                radial-gradient(2px 2px at 240px 90px, #fff, transparent),
                radial-gradient(1px 1px at 280px 20px, #fff, transparent),
                radial-gradient(1px 1px at 320px 50px, #fff, transparent),
                radial-gradient(2px 2px at 360px 80px, #fff, transparent);
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .header h1, .header p {
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .content {
            padding: 30px;
            color: white;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }
        
        .tab-button {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #3f51b5 0%, #5c6bc0 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(63, 81, 181, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e8eaf6;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            color: #333;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 15px rgba(63, 81, 181, 0.4);
        }
        
        .options-container {
            margin-bottom: 20px;
        }
        
        .option-input {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .option-input input {
            margin-right: 10px;
        }
        
        .remove-option {
            padding: 8px 12px;
            background: linear-gradient(135deg, #e53935 0%, #ef5350 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s ease;
        }

        .remove-option:hover {
            transform: scale(1.05);
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3f51b5 0%, #5c6bc0 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #5e35b1 0%, #7e57c2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .poll-link {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #43a047;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .poll-link input {
            width: 100%;
            background: transparent;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #43a047;
        }
        
        .voting-option {
            background: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
        }
        
        .voting-option:hover {
            border-color: #3f51b5;
            box-shadow: 0 4px 15px rgba(63, 81, 181, 0.3);
            transform: translateY(-2px);
        }
        
        .voting-option.selected {
            border-color: #3f51b5;
            background: linear-gradient(135deg, #3f51b5 0%, #5c6bc0 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(63, 81, 181, 0.4);
        }
        
        .results-container {
            margin-top: 30px;
        }
        
        .result-item {
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            color: #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .result-bar {
            background: #e8eaf6;
            border-radius: 10px;
            height: 30px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .result-fill {
            height: 100%;
            background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-weight: 600;
            transition: width 0.5s ease;
        }
        
        .voter-name {
            background: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
        }
        
        .voter-name input {
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            width: 100%;
        }
        
        .success-message {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #e8f5e8;
            text-align: center;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #ffebee;
            text-align: center;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .poll-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .poll-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .poll-description {
            color: #666;
            font-size: 16px;
        }

        h2 {
            color: #e8eaf6;
            margin-bottom: 20px;
        }

        .voter-name label,
        .poll-link label {
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #e8eaf6;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .connection-status.connected {
            background: #4caf50;
            color: white;
        }

        .connection-status.disconnected {
            background: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Připojování...</div>
    
    <div class="container">
        <div class="header">
            <h1>🗳️ Tomova hlasovací aplikace</h1>
                    </div>
        
        <div class="content">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('create')">Vytvořit hlasování</button>
                <button class="tab-button" onclick="showTab('vote')">Hlasovat</button>
                <button class="tab-button" onclick="showTab('results')">Výsledky</button>
            </div>
            
            <!-- Vytvoření hlasování -->
            <div id="create" class="tab-content active">
                <h2>Vytvořte nové hlasování</h2>
                
                <div class="form-group">
                    <label for="pollTitle">Název hlasování:</label>
                    <input type="text" id="pollTitle" placeholder="Např. Kde půjdeme na oběd?">
                </div>
                
                <div class="form-group">
                    <label for="pollDescription">Popis (volitelné):</label>
                    <textarea id="pollDescription" rows="3" placeholder="Další informace k hlasování..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Možnosti hlasování:</label>
                    <div class="options-container" id="optionsContainer">
                        <div class="option-input">
                            <input type="text" placeholder="Možnost 1" class="option-text">
                            <button type="button" class="remove-option" onclick="removeOption(this)" style="display:none;">Odebrat</button>
                        </div>
                        <div class="option-input">
                            <input type="text" placeholder="Možnost 2" class="option-text">
                            <button type="button" class="remove-option" onclick="removeOption(this)">Odebrat</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addOption()">Přidat možnost</button>
                </div>
                
                <button type="button" class="btn btn-primary" id="createPollBtn" onclick="createPoll()">Vytvořit hlasování</button>
                
                <div id="pollCreated" style="display:none;">
                    <div class="success-message">
                        Hlasování bylo úspěšně vytvořeno! Zkopírujte odkaz níže a pošlete jej kolegům.
                    </div>
                    <div class="poll-link">
                        <label>Odkaz pro hlasování:</label>
                        <input type="text" id="pollLinkInput" readonly>
                    </div>
                    <button type="button" class="btn btn-success" onclick="copyLink()">Zkopírovat odkaz</button>
                </div>
            </div>
            
            <!-- Hlasování -->
            <div id="vote" class="tab-content">
                <div id="votingForm">
                    <div class="voter-name">
                        <label>Vaše jméno:</label>
                        <input type="text" id="voterName" placeholder="Zadejte své jméno">
                    </div>
                    
                    <div id="pollInfo">
                        <p>Pro hlasování zadejte ID hlasování nebo použijte odkaz zaslaný kolegou.</p>
                        <div class="form-group">
                            <label for="pollId">ID hlasování:</label>
                            <input type="text" id="pollId" placeholder="Zadejte ID hlasování">
                            <button type="button" class="btn btn-primary" id="loadPollBtn" onclick="loadPoll()">Načíst hlasování</button>
                        </div>
                    </div>
                    
                    <div id="pollDetails" style="display:none;">
                        <div class="poll-header">
                            <div class="poll-title" id="votePollTitle"></div>
                            <div class="poll-description" id="votePollDescription"></div>
                        </div>
                        
                        <div id="votingOptions"></div>
                        
                        <button type="button" class="btn btn-primary" onclick="submitVote()" id="submitVoteBtn">Hlasovat</button>
                    </div>
                    
                    <div id="voteSuccess" style="display:none;">
                        <div class="success-message">
                            Děkujeme za váš hlas! Výsledky najdete v záložce "Výsledky".
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Výsledky -->
            <div id="results" class="tab-content">
                <div class="form-group">
                    <label for="resultsId">ID hlasování:</label>
                    <input type="text" id="resultsId" placeholder="Zadejte ID hlasování">
                    <button type="button" class="btn btn-primary" id="loadResultsBtn" onclick="loadResults()">Načíst výsledky</button>
                </div>
                
                <div id="resultsContainer" style="display:none;">
                    <div class="poll-header">
                        <div class="poll-title" id="resultsPollTitle"></div>
                        <div class="poll-description" id="resultsPollDescription"></div>
                    </div>
                    
                    <div class="results-container" id="resultsData"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>
    
    <script>
        // Firebase konfigurace - DEMO konfigurace (vyměňte za svou vlastní)
        const firebaseConfig = {
            apiKey: "demo-key",
            authDomain: "demo-voting-app.firebaseapp.com",
            databaseURL: "https://demo-voting-app-default-rtdb.firebaseio.com/",
            projectId: "demo-voting-app",
            storageBucket: "demo-voting-app.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:demo"
        };
        
        // Pro demo účely použijeme localStorage s simulací Firebase API
        class FirebaseSimulator {
            constructor() {
                this.data = JSON.parse(localStorage.getItem('firebase_demo_data') || '{}');
                this.connected = true;
                this.updateConnectionStatus();
            }
            
            updateConnectionStatus() {
                const status = document.getElementById('connectionStatus');
                if (this.connected) {
                    status.textContent = 'Online';
                    status.className = 'connection-status connected';
                } else {
                    status.textContent = 'Offline';
                    status.className = 'connection-status disconnected';
                }
            }
            
            ref(path) {
                return {
                    set: (data) => {
                        return new Promise((resolve) => {
                            setTimeout(() => {
                                const keys = path.split('/').filter(k => k);
                                let current = this.data;
                                for (let i = 0; i < keys.length - 1; i++) {
                                    if (!current[keys[i]]) current[keys[i]] = {};
                                    current = current[keys[i]];
                                }
                                current[keys[keys.length - 1]] = data;
                                localStorage.setItem('firebase_demo_data', JSON.stringify(this.data));
                                resolve();
                            }, Math.random() * 500 + 200); // Simulace síťového zpoždění
                        });
                    },
                    
                    once: (event) => {
                        return new Promise((resolve) => {
                            setTimeout(() => {
                                const keys = path.split('/').filter(k => k);
                                let current = this.data;
                                for (let key of keys) {
                                    current = current && current[key];
                                }
                                resolve({
                                    val: () => current || null,
                                    exists: () => current !== null && current !== undefined
                                });
                            }, Math.random() * 300 + 100);
                        });
                    },
                    
                    on: (event, callback) => {
                        // Pro jednoduchost neimplementujeme real-time updates
                        this.once(event).then(callback);
                    }
                };
            }
        }
        
        // Inicializace Firebase simulátoru
        const database = new FirebaseSimulator();
        
        // Globální proměnné
        let currentPollId = '';
        let selectedOption = '';
        
        // Načtení při startu
        window.onload = function() {
            // Kontrola URL parametrů pro přímé hlasování
            const urlParams = new URLSearchParams(window.location.search);
            const pollId = urlParams.get('poll');
            if (pollId) {
                document.getElementById('pollId').value = pollId;
                showTab('vote');
                loadPoll();
            }
        };
        
        function showTab(tabName) {
            // Skrýt všechny záložky
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Zobrazit vybranou záložky
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        function addOption() {
            const container = document.getElementById('optionsContainer');
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-input';
            
            const optionCount = container.children.length + 1;
            optionDiv.innerHTML = `
                <input type="text" placeholder="Možnost ${optionCount}" class="option-text">
                <button type="button" class="remove-option" onclick="removeOption(this)">Odebrat</button>
            `;
            
            container.appendChild(optionDiv);
            updateRemoveButtons();
        }
        
        function removeOption(button) {
            button.parentElement.remove();
            updateRemoveButtons();
        }
        
        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.remove-option');
            removeButtons.forEach((btn, index) => {
                btn.style.display = removeButtons.length > 2 ? 'block' : (index === 0 ? 'none' : 'block');
            });
        }
        
        async function createPoll() {
            const title = document.getElementById('pollTitle').value.trim();
            const description = document.getElementById('pollDescription').value.trim();
            const optionInputs = document.querySelectorAll('.option-text');
            const createBtn = document.getElementById('createPollBtn');
            
            if (!title) {
                showMessage('Zadejte název hlasování!', 'error');
                return;
            }
            
            const options = [];
            optionInputs.forEach(input => {
                if (input.value.trim()) {
                    options.push(input.value.trim());
                }
            });
            
            if (options.length < 2) {
                showMessage('Musíte zadat alespoň 2 možnosti!', 'error');
                return;
            }
            
            // Zabránit dvojitému kliknutí
            createBtn.disabled = true;
            createBtn.textContent = 'Vytváří se...';
            
            try {
                // Generování ID
                const pollId = 'poll_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
                
                // Vytvoření hlasování v databázi
                const pollData = {
                    title: title,
                    description: description,
                    options: options,
                    votes: {},
                    created: new Date().toISOString()
                };
                
                await database.ref(`polls/${pollId}`).set(pollData);
                
                // Zobrazení odkazu
                const pollLink = window.location.href.split('?')[0] + '?poll=' + pollId;
                document.getElementById('pollLinkInput').value = pollLink;
                document.getElementById('pollCreated').style.display = 'block';
                
                // Reset formuláře
                document.getElementById('pollTitle').value = '';
                document.getElementById('pollDescription').value = '';
                optionInputs.forEach(input => input.value = '');
                
                showMessage('Hlasování bylo úspěšně vytvořeno!', 'success');
                
            } catch (error) {
                console.error('Chyba při vytváření hlasování:', error);
                showMessage('Chyba při vytváření hlasování. Zkuste to znovu.', 'error');
            } finally {
                createBtn.disabled = false;
                createBtn.textContent = 'Vytvořit hlasování';
            }
        }
        
        function copyLink() {
            const linkInput = document.getElementById('pollLinkInput');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // Pro mobilní zařízení
            
            try {
                document.execCommand('copy');
                showMessage('Odkaz byl zkopírován do schránky!', 'success');
            } catch (err) {
                console.error('Chyba při kopírování:', err);
                showMessage('Kopírování se nezdařilo. Zkopírujte odkaz ručně.', 'error');
            }
        }
        
        async function loadPoll() {
            const pollId = document.getElementById('pollId').value.trim();
            const loadBtn = document.getElementById('loadPollBtn');
            
            if (!pollId) {
                showMessage('Zadejte ID hlasování!', 'error');
                return;
            }
            
            loadBtn.disabled = true;
            loadBtn.textContent = 'Načítá se...';
            
            try {
                const snapshot = await database.ref(`polls/${pollId}`).once('value');
                
                if (!snapshot.exists()) {
                    showMessage('Hlasování s tímto ID neexistuje!', 'error');
                    return;
                }
                
                const poll = snapshot.val();
                currentPollId = pollId;
                
                // Zobrazení informací o hlasování
                document.getElementById('votePollTitle').textContent = poll.title;
                document.getElementById('votePollDescription').textContent = poll.description || '';
                
                // Vytvoření možností hlasování
                const optionsContainer = document.getElementById('votingOptions');
                optionsContainer.innerHTML = '';
                
                poll.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'voting-option';
                    optionDiv.textContent = option;
                    optionDiv.onclick = () => selectOption(option, optionDiv);
                    optionsContainer.appendChild(optionDiv);
                });
                
                document.getElementById('pollInfo').style.display = 'none';
                document.getElementById('pollDetails').style.display = 'block';
                
            } catch (error) {
                console.error('Chyba při načítání hlasování:', error);
                showMessage('Chyba při načítání hlasování. Zkuste to znovu.', 'error');
            } finally {
                loadBtn.disabled = false;
                loadBtn.textContent = 'Načíst hlasování';
            }
        }
        
        function selectOption(option, element) {
            // Odstranit výběr z ostatních možností
            document.querySelectorAll('.voting-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Vybrat aktuální možnost
            element.classList.add('selected');
            selectedOption = option;
        }
        
        async function submitVote() {
            const voterName = document.getElementById('voterName').value.trim();
            const submitBtn = document.getElementById('submitVoteBtn');
            
            if (!voterName) {
                showMessage('Zadejte své jméno!', 'error');
                return;
            }
            
            if (!selectedOption) {
                showMessage('Vyberte možnost pro hlasování!', 'error');
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Hlasuje se...';
            
            try {
                // Kontrola, zda už uživatel hlasoval
                const votesSnapshot = await database.ref(`polls/${currentPollId}/votes`).once('value');
                const votes = votesSnapshot.val() || {};
                
                if (votes[voterName]) {
                    showMessage('Už jste hlasoval/a v tomto hlasování!', 'error');
                    return;
                }
                
                // Uložení hlasu
                await database.ref(`polls/${currentPollId}/votes/${voterName}`).set(selectedOption);
                
                document.getElementById('pollDetails').style.display = 'none';
                document.getElementById('voteSuccess').style.display = 'block';
                
            } catch (error) {
                console.error('Chyba při hlasování:', error);
                showMessage('Chyba při hlasování. Zkuste to znovu.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Hlasovat';
            }
        }
        
        async function loadResults() {
            const pollId = document.getElementById('resultsId').value.trim();
            const loadBtn = document.getElementById('loadResultsBtn');
            
            if (!pollId) {
                showMessage('Zadejte ID hlasování!', 'error');
                return;
            }
            
            loadBtn.disabled = true;
            loadBtn.
